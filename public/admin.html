<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>사유서 제작 - 관리</title>
    <link rel="stylesheet" href="css/fonts.css">
    <link rel="stylesheet" href="css/admin.css">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha384-1H217gwSVyLSIfaLxHbE7dRb3v4mYCKbpQvzx0cegeju1MVsGrX5xXxAvs/HgeFs" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.7/css/jquery.dataTables.min.css" integrity="sha384-cya1SKeBBe5YTpHgx4WoICmzqkoHTxoGqjPySUq2nLksbJ/JiKXX2RmhyLz6jwST" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.datatables.net/select/1.7.0/css/select.dataTables.min.css" integrity="sha384-P82uzAoBEm1hxQbD1Ox+ohCxw4LCZc2mJVl5VS9raZC2+1ZRzuHGQ2px0Lox8HO8" crossorigin="anonymous">
    <script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js" integrity="sha384-cjmdOgDzOE22dUheI5E6Gzd3upfmReW8N1y/4jwKQE50KYcvFKZJA9JxWgQOzqwQ" crossorigin="anonymous"></script>
    <script src="https://cdn.datatables.net/select/1.7.0/js/dataTables.select.min.js" integrity="sha384-5UUEYV/x07jNYpizRK5+tnFvFPDDq5s5wVr5mc802xveN8Ve7kuFu4Ym6mN+QcmZ" crossorigin="anonymous"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.14.5/dist/sweetalert2.all.min.js" integrity="sha384-YB/DdIkloKoRpclWB8bNcYXWakt57USgtQPDzvnIDHYU0lasD5eWlXVo1S4ODukY" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js" integrity="sha384-vtjasyidUo0kW94K5MXDXntzOJpQgBKXmE7e2Ga4LG0skTTLeBi97eFAXsqewJjw" crossorigin="anonymous"></script>
    <script src="js/tailwind-config.js"></script>
</head>
<body class="bg-[#FAFAFA] min-h-screen">

    <!-- 로그인 -->
    <div id="loginOverlay" class="fixed inset-0 bg-[#1A1A1A] z-[100] flex items-center justify-center p-4">
        <div class="bg-white rounded-lg p-10 w-full max-w-sm shadow-lg text-center">
            <h1 class="text-2xl font-bold text-[#1A1A1A] mb-1 tracking-tight">사유서 제작</h1>
            <p class="text-[#A3A3A3] text-sm mb-8">관리자 로그인</p>
            <form id="loginForm" class="space-y-3">
                <input type="text" id="adminUsername" placeholder="아이디" required class="w-full border border-[#E5E5E5] rounded-md px-4 py-3 outline-none focus:border-[#A3A3A3] font-medium text-[#1A1A1A] placeholder-[#D4D4D4]">
                <input type="password" id="adminPassword" placeholder="비밀번호" required class="w-full border border-[#E5E5E5] rounded-md px-4 py-3 outline-none focus:border-[#A3A3A3] font-medium text-[#1A1A1A] placeholder-[#D4D4D4]">
                <button type="submit" class="w-full bg-[#1A1A1A] text-white font-bold py-3 rounded-md hover:bg-[#333] transition-colors">로그인</button>
            </form>
        </div>
    </div>

    <!-- 관리자 -->
    <div id="adminContent" class="hidden">
        <!-- 네비게이션 -->
        <nav class="bg-white border-b border-[#E5E5E5] px-4 sm:px-8 py-3 flex justify-between items-center sticky top-0 z-50">
            <a href="/" class="text-[15px] font-bold tracking-tight text-[#1A1A1A] hover:text-[#525252] transition-colors no-underline">사유서 제작</a>
            <div class="flex items-center gap-3 sm:gap-4">
                <span id="adminClock" class="text-xs font-bold text-[#A3A3A3] tabular-nums tracking-tight hidden sm:inline"></span>
                <span id="adminInfo" class="text-xs font-medium text-[#A3A3A3] hidden sm:inline"></span>
                <button onclick="logout()" class="text-[11px] font-semibold text-[#A3A3A3] hover:text-[#1A1A1A] border border-[#E5E5E5] px-2.5 py-1 rounded-md transition-colors">로그아웃</button>
            </div>
        </nav>

        <main class="max-w-[1800px] mx-auto px-4 sm:px-8 py-4 sm:py-6 space-y-3">
            <!-- 툴바: 검색 + 필터 + 액션 -->
            <div class="bg-white border border-[#E5E5E5] rounded-md px-4 py-3 space-y-3">
                <!-- 상단: 제목 + 액션 버튼 -->
                <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
                    <h2 class="text-lg font-bold text-[#1A1A1A] tracking-tight whitespace-nowrap">전체 신청 건</h2>
                    <div class="flex items-center gap-2">
                        <select id="customPageLength" class="bg-[#FAFAFA] border border-[#E5E5E5] rounded-md px-3 py-2 text-sm font-semibold text-[#404040] outline-none focus:border-[#A3A3A3] cursor-pointer">
                            <option value="25">25건</option>
                            <option value="50">50건</option>
                            <option value="100">100건</option>
                            <option value="-1">전체</option>
                        </select>
                        <button onclick="exportToExcel()" class="border border-[#E5E5E5] text-[#404040] px-5 py-2 rounded-md font-semibold text-sm hover:bg-[#F5F5F5] transition-colors flex items-center gap-2 whitespace-nowrap">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                            엑셀
                        </button>
                        <button onclick="openCreateModal()" class="bg-[#1A1A1A] text-white px-5 py-2 rounded-md font-semibold text-sm hover:bg-[#333] transition-colors flex items-center gap-2 whitespace-nowrap">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M12 4v16m8-8H4"/></svg>
                            신규 등록
                        </button>
                        <button id="btnBulkDelete" onclick="bulkDelete()" class="hidden border border-red-300 text-red-600 px-5 py-2 rounded-md font-semibold text-sm hover:bg-red-50 transition-colors items-center gap-2 whitespace-nowrap">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>
                            <span id="bulkDeleteLabel">선택 삭제</span>
                        </button>
                    </div>
                </div>
                <!-- 하단: 검색 + 필터 -->
                <div class="flex flex-wrap items-center gap-2 pt-2 border-t border-[#F0F0F0]">
                    <div class="relative">
                        <svg class="w-4 h-4 absolute left-3 top-1/2 -translate-y-1/2 text-[#A3A3A3]" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
                        <input type="text" id="customSearch" placeholder="이름, 코드, 연락처 검색" class="bg-[#FAFAFA] border border-[#E5E5E5] rounded-md pl-9 pr-4 py-2 text-sm font-medium text-[#1A1A1A] outline-none focus:border-[#A3A3A3] focus:bg-white w-56 placeholder-[#A3A3A3] transition-colors">
                    </div>
                    <div class="w-px h-6 bg-[#E5E5E5] mx-1 hidden sm:block"></div>
                    <select id="filter_contractor" class="bg-[#FAFAFA] border border-[#E5E5E5] rounded-md px-3 py-2 text-sm font-semibold text-[#404040] outline-none focus:border-[#A3A3A3] cursor-pointer"></select>
                    <select id="filter_merchant" class="bg-[#FAFAFA] border border-[#E5E5E5] rounded-md px-3 py-2 text-sm font-semibold text-[#404040] outline-none focus:border-[#A3A3A3] cursor-pointer"></select>
                    <select id="filter_status" class="bg-[#FAFAFA] border border-[#E5E5E5] rounded-md px-3 py-2 text-sm font-semibold text-[#404040] outline-none focus:border-[#A3A3A3] cursor-pointer">
                        <option value="">상태: 전체</option>
                        <option value="대기">대기</option>
                        <option value="접수">접수</option>
                        <option value="처리중">처리중</option>
                        <option value="완료">완료</option>
                        <option value="반려">반려</option>
                    </select>
                    <select id="filter_type" class="bg-[#FAFAFA] border border-[#E5E5E5] rounded-md px-3 py-2 text-sm font-semibold text-[#404040] outline-none focus:border-[#A3A3A3] cursor-pointer">
                        <option value="">유형: 전체</option>
                        <option value="반환청구">반환청구</option>
                        <option value="오입금">오입금</option>
                    </select>
                    <button onclick="resetFilters()" class="text-xs font-semibold text-[#A3A3A3] hover:text-[#1A1A1A] border border-transparent hover:border-[#E5E5E5] rounded-md px-3 py-2 transition-all">초기화</button>
                    <span id="filterCount" class="text-xs font-bold text-[#A3A3A3] ml-auto hidden sm:inline"></span>
                </div>
            </div>

            <!-- 테이블 -->
            <div class="table-container">
                <table id="requestTable" class="w-full">
                    <thead>
                        <tr>
                            <th><input type="checkbox" id="selectAll" class="cursor-pointer"></th>
                            <th>신청일</th>
                            <th>식별코드</th>
                            <th>유형</th>
                            <th>계약자 코드</th>
                            <th>가맹점 코드</th>
                            <th>신청인</th>
                            <th>연락처</th>
                            <th>입금일</th>
                            <th>입금액</th>
                            <th>사용계좌</th>
                            <th>상태</th>
                            <th>상세</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </main>
    </div>

    <!-- 상세 모달 — 뷰포트 내 맞춤 -->
    <div id="detailModal" class="hidden fixed inset-0 bg-[#525252]/60 z-50 flex items-center justify-center p-2 sm:p-4">
        <div class="bg-white w-full max-w-[720px] shadow-lg rounded-lg relative flex flex-col" style="max-height: calc(100vh - 2rem);">
            <!-- 닫기 버튼 -->
            <button onclick="closeModal()" class="modal-close-btn absolute top-2 right-2 sm:-top-3 sm:-right-3 w-7 h-7 bg-white rounded-md shadow-sm border border-gray-200 flex items-center justify-center text-[#A3A3A3] hover:text-[#1A1A1A] transition-colors text-sm z-10">&times;</button>

            <!-- 용지 내용 (스크롤 영역) -->
            <div id="modalBody" class="px-5 py-5 sm:px-10 sm:py-8 overflow-y-auto flex-1 min-h-0"></div>

            <!-- 하단 액션 (고정) -->
            <div class="modal-footer border-t border-[#E5E5E5] px-5 py-3 sm:px-10 sm:py-4 flex justify-between items-center gap-3 flex-shrink-0">
                <div class="flex items-center gap-2">
                    <button onclick="closeModal()" class="border border-[#E5E5E5] text-[#525252] px-4 sm:px-6 py-2 rounded-md font-bold text-sm hover:bg-[#F5F5F5] transition-colors">닫기</button>
                    <button id="btnDelete" onclick="deleteRequest()" class="border border-red-300 text-red-600 px-4 sm:px-6 py-2 rounded-md font-bold text-sm hover:bg-red-50 transition-colors">삭제</button>
                </div>
                <div class="flex items-center gap-2">
                    <button id="btnEdit" onclick="toggleEditMode()" class="border border-[#E5E5E5] text-[#525252] px-4 sm:px-6 py-2 rounded-md font-bold text-sm hover:bg-[#F5F5F5] transition-colors">수정</button>
                    <button id="btnSaveEdit" onclick="saveEdit()" class="hidden bg-blue-600 text-white px-4 sm:px-6 py-2 rounded-md font-bold text-sm hover:bg-blue-700 transition-colors">저장</button>
                    <button id="btnSaveCreate" onclick="saveCreate()" class="hidden bg-[#1A1A1A] text-white px-4 sm:px-6 py-2 rounded-md font-bold text-sm hover:bg-[#333] transition-colors">등록</button>
                    <button id="btnCancelEdit" onclick="cancelEditMode()" class="hidden border border-[#E5E5E5] text-[#525252] px-4 sm:px-6 py-2 rounded-md font-bold text-sm hover:bg-[#F5F5F5] transition-colors">취소</button>
                    <button id="btnDownloadWord" onclick="downloadWord()" class="bg-blue-600 text-white px-4 sm:px-6 py-2 rounded-md font-bold text-sm hover:bg-blue-700 transition-colors">Word 다운로드</button>
                    <button id="btnPrint" onclick="printPage()" class="bg-[#1A1A1A] text-white px-4 sm:px-6 py-2 rounded-md font-bold text-sm hover:bg-[#333] transition-colors">인쇄</button>
                </div>
            </div>
        </div>
    </div>

    <script src="js/admin.js"></script>
</body>
</html>
